<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Power Debate Preparation Tool</title>
</head>
<body>
    <nuclear-debate-prep></nuclear-debate-prep>

    <script>
    (function() {
        if (customElements.get('nuclear-debate-prep')) return;

        // --- SVG ICONS ---
        const icons = {
            Scale: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>`,
            Printer: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>`,
            BookOpen: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>`,
            ChevronUp: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 15-6-6-6 6"/></svg>`,
            ChevronDown: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>`,
            ExternalLink: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>`,
            Lightbulb: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`,
            Trash2: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>`,
            Plus: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>`,
            FileText: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>`,
            Award: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>`,
            AlertTriangle: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
            Clock: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
            X: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
            CheckCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            Circle: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>`
        };

        // --- STYLES (unchanged) ---
        const css = `
            :host { 
                display: block; 
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                line-height: 1.6;
            }
            * { box-sizing: border-box; margin: 0; padding: 0; }
            
            .skip-link {
                position: absolute;
                top: -40px;
                left: 0;
                background: #e8a838;
                color: #000;
                padding: 8px 16px;
                text-decoration: none;
                z-index: 100;
                font-weight: 700;
                border-radius: 0 0 4px 0;
            }
            .skip-link:focus {
                top: 0;
            }
            
            .container { 
                min-height: 100vh; 
                background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 50%, #1e3a5f 100%); 
                padding: 2rem; 
            }
            .max-w-6xl { max-width: 1200px; margin: 0 auto; }
            
            .header-panel { 
                background: linear-gradient(to right, #1e3a8a, #1e40af);
                border: 4px solid #3b82f6; 
                border-radius: 1rem; 
                padding: 2.5rem; 
                margin-bottom: 2rem;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            }
            
            .logo-container {
                display: flex;
                align-items: center;
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .logo-circle {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                background: linear-gradient(135deg, #e8a838, #d4941a);
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                flex-shrink: 0;
                box-shadow: 0 0 30px rgba(232, 168, 56, 0.5);
            }
            
            .pulse-ring {
                position: absolute;
                top: -4px;
                right: -4px;
                width: 20px;
                height: 20px;
                background: #22c55e;
                border-radius: 50%;
                animation: pulse 2s ease-in-out infinite;
            }
            
            @keyframes pulse {
                0%, 100% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.3); opacity: 0.6; }
            }
            
            h1 {
                font-size: 2.5rem;
                font-weight: 800;
                color: #e8a838;
                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                letter-spacing: 0.05em;
                margin: 0;
            }
            
            .subtitle {
                font-size: 1.1rem;
                color: #86efac;
                font-weight: 600;
                font-family: 'Courier New', monospace;
                margin-top: 0.5rem;
            }
            
            .intro-text {
                font-size: 1.15rem;
                color: #ffffff;
                line-height: 1.7;
                border-left: 4px solid #e8a838;
                padding-left: 1.5rem;
                margin: 1.5rem 0;
            }
            
            .button-group {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                margin-top: 1rem;
            }

            .getting-started {
                background: #dcfce7;
                border: 3px solid #22c55e;
                border-radius: 0.75rem;
                padding: 1.5rem;
                margin-bottom: 2rem;
                position: relative;
            }

            .getting-started h3 {
                color: #14532d;
                font-size: 1.3rem;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .getting-started ol {
                color: #14532d;
                font-size: 1.05rem;
                line-height: 1.8;
                margin-left: 1.5rem;
            }

            .getting-started li {
                margin-bottom: 0.5rem;
            }

            .getting-started p {
                color: #166534;
                font-size: 1rem;
                margin-top: 1rem;
                font-weight: 600;
            }

            .dismiss-guide {
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: #22c55e;
                color: white;
                border: none;
                padding: 0.5rem;
                border-radius: 0.25rem;
                cursor: pointer;
                font-weight: 700;
            }

            .dismiss-guide:hover {
                background: #16a34a;
            }

            .progress-tracker {
                background: #1e293b;
                border: 3px solid #475569;
                border-radius: 0.75rem;
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .progress-tracker h3 {
                color: #e8a838;
                font-size: 1.2rem;
                margin-bottom: 1rem;
            }

            .progress-items {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 0.75rem;
            }

            .progress-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #cbd5e1;
                font-size: 0.95rem;
            }

            .progress-item.complete {
                color: #86efac;
            }

            .progress-icon {
                flex-shrink: 0;
            }
            
            .controls-panel {
                background: #1e293b;
                border: 3px solid #475569;
                border-radius: 0.75rem;
                padding: 2rem;
                margin-bottom: 2rem;
            }
            
            .grid-2 {
                display: grid;
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            @media (min-width: 768px) {
                .grid-2 { grid-template-columns: repeat(2, 1fr); }
            }
            
            label {
                display: block;
                font-size: 1rem;
                font-weight: 700;
                color: #e8a838;
                letter-spacing: 0.05em;
                margin-bottom: 0.75rem;
                text-transform: uppercase;
            }
            
            label.inline {
                text-transform: none;
                font-size: 0.9rem;
                color: #93c5fd;
                margin-bottom: 0.5rem;
            }
            
            input, select, textarea {
                width: 100%;
                padding: 1rem 1.25rem;
                font-size: 1.1rem;
                font-family: 'Consolas', 'Courier New', monospace;
                background: #0f172a;
                color: #86efac;
                border: 2px solid #475569;
                border-radius: 0.5rem;
                transition: all 0.2s ease;
            }
            
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: #e8a838;
                box-shadow: 0 0 0 3px rgba(232, 168, 56, 0.3);
                background: #1e293b;
            }
            
            input::placeholder, textarea::placeholder {
                color: #94a3b8;
                opacity: 1;
            }
            
            textarea {
                min-height: 140px;
                resize: vertical;
                line-height: 1.6;
            }
            
            textarea.compact {
                min-height: 80px;
            }
            
            input[type="number"] {
                font-size: 1rem;
                padding: 0.75rem;
            }
            
            button {
                font-family: inherit;
                cursor: pointer;
                border: none;
                background: none;
                font-size: 1rem;
                transition: all 0.2s ease;
            }
            
            .btn-primary {
                display: inline-flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.875rem 1.75rem;
                font-size: 1.1rem;
                font-weight: 700;
                color: #ffffff;
                background: linear-gradient(135deg, #16a34a, #22c55e);
                border: 2px solid #4ade80;
                border-radius: 0.5rem;
                box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            }
            
            .btn-primary:hover {
                background: linear-gradient(135deg, #15803d, #16a34a);
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
            }
            
            .btn-primary:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .btn-secondary {
                display: inline-flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.875rem 1.75rem;
                font-size: 1.1rem;
                font-weight: 700;
                color: #ffffff;
                background: linear-gradient(135deg, #7c3aed, #a855f7);
                border: 2px solid #c084fc;
                border-radius: 0.5rem;
                box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
            }
            
            .btn-secondary:hover {
                background: linear-gradient(135deg, #6d28d9, #7c3aed);
                transform: translateY(-2px);
            }
            
            .btn-secondary:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .btn-add {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                font-weight: 700;
                color: #ffffff;
                background: #3b82f6;
                border: 2px solid #60a5fa;
                border-radius: 0.5rem;
                margin-top: 1rem;
            }
            
            .btn-add:hover {
                background: #2563eb;
                transform: translateY(-1px);
            }
            
            .btn-add:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .btn-delete {
                color: #f87171;
                padding: 0.5rem;
                font-weight: 600;
            }
            
            .btn-delete:hover {
                color: #fca5a5;
            }
            
            .btn-delete:focus {
                outline: 2px solid #f87171;
                outline-offset: 2px;
                border-radius: 4px;
            }

            .btn-delete-example {
                display: inline-flex;
                align-items: center;
                gap: 0.25rem;
                padding: 0.25rem 0.5rem;
                background: #dc2626;
                color: white;
                border: none;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                font-weight: 700;
                margin-left: 0.5rem;
            }

            .btn-delete-example:hover {
                background: #b91c1c;
            }
            
            .section-panel {
                background: #1e293b;
                border: 3px solid #475569;
                border-radius: 0.75rem;
                margin-bottom: 2rem;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }
            
            .section-header {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 1.75rem 2rem;
                background: linear-gradient(to right, #1e293b, #334155);
                border-bottom: 2px solid #475569;
                text-align: left;
            }
            
            .section-header:hover {
                background: linear-gradient(to right, #334155, #475569);
            }
            
            .section-header:focus {
                outline: 3px solid #e8a838;
                outline-offset: -3px;
            }
            
            .section-title {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .section-title h2 {
                font-size: 1.5rem;
                font-weight: 700;
                color: #e8a838;
                letter-spacing: 0.05em;
                margin: 0;
            }
            
            .section-content {
                padding: 2rem;
            }
            
            .info-box {
                padding: 1.25rem 1.5rem;
                border-left: 4px solid;
                border-radius: 0.5rem;
                margin-bottom: 1.5rem;
                font-size: 1.05rem;
                line-height: 1.6;
            }
            
            .info-box-blue {
                background: #dbeafe;
                border-color: #3b82f6;
                color: #1e3a8a;
            }
            
            .info-box-purple {
                background: #f3e8ff;
                border-color: #a855f7;
                color: #6b21a8;
            }
            
            .info-box-green {
                background: #dcfce7;
                border-color: #22c55e;
                color: #14532d;
            }
            
            .info-box-yellow {
                background: #fef3c7;
                border-color: #f59e0b;
                color: #78350f;
            }
            
            .info-box strong {
                font-weight: 700;
            }

            .source-link {
                color: #1e40af;
                text-decoration: none;
                font-weight: 600;
                border-bottom: 1px dotted #1e40af;
            }

            .source-link:hover {
                color: #2563eb;
                border-bottom: 1px solid #2563eb;
            }
            
            .card {
                background: #0f172a;
                border: 2px solid #475569;
                border-left: 4px solid;
                border-radius: 0.5rem;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .card-blue { border-left-color: #60a5fa; }
            .card-green { border-left-color: #4ade80; }
            .card-purple { border-left-color: #c084fc; }
            .card-orange { border-left-color: #fb923c; }
            .card-teal { border-left-color: #2dd4bf; }
            .card-red { border-left-color: #f87171; }
            
            .card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }
            
            .card-title {
                font-size: 1.1rem;
                font-weight: 700;
                color: #ffffff;
            }
            
            .card-blue .card-title { color: #93c5fd; }
            .card-green .card-title { color: #86efac; }
            .card-purple .card-title { color: #d8b4fe; }
            .card-orange .card-title { color: #fdba74; }
            .card-teal .card-title { color: #5eead4; }
            .card-red .card-title { color: #fca5a5; }

            .example-badge {
                display: inline-flex;
                align-items: center;
                gap: 0.25rem;
                background: #fbbf24;
                color: #78350f;
                padding: 0.25rem 0.5rem;
                border-radius: 9999px;
                font-size: 0.75rem;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-left: 0.5rem;
            }
            
            .craap-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 0.75rem;
                margin-top: 1rem;
                margin-bottom: 1rem;
            }
            
            .craap-item {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .craap-item label {
                font-size: 0.8rem;
                margin-bottom: 0.25rem;
            }
            
            .help-text {
                font-size: 0.85rem;
                font-style: italic;
                color: #94a3b8;
                margin-top: 0.5rem;
                line-height: 1.5;
            }
            
            details {
                margin-bottom: 1.5rem;
                background: #f8fafc;
                padding: 1rem;
                border-left: 4px solid #a855f7;
                border-radius: 0.5rem;
            }
            
            summary {
                cursor: pointer;
                font-weight: 700;
                color: #6b21a8;
                margin-bottom: 0.5rem;
                list-style: none;
            }
            
            summary::-webkit-details-marker {
                display: none;
            }
            
            summary::before {
                content: 'ðŸ“š ';
                margin-right: 0.5rem;
            }
            
            details[open] summary::before {
                content: 'ðŸ“– ';
            }
            
            details div {
                color: #1e293b;
                font-size: 1rem;
                line-height: 1.6;
                margin-top: 0.75rem;
            }
            
            details ul {
                margin-left: 1.5rem;
                margin-top: 0.5rem;
            }
            
            details li {
                margin-bottom: 0.5rem;
            }
            
            .resource-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 1.5rem;
                margin-top: 1.5rem;
            }
            
            @media (min-width: 768px) {
                .resource-grid { grid-template-columns: repeat(2, 1fr); }
            }
            
            .resource-card {
                background: #f8fafc;
                border: 2px solid #cbd5e1;
                border-radius: 0.5rem;
                padding: 1.5rem;
            }
            
            .resource-card h4 {
                font-size: 1.1rem;
                font-weight: 700;
                color: #1e40af;
                margin-bottom: 0.75rem;
            }
            
            .resource-authority {
                display: inline-block;
                font-size: 0.8rem;
                font-weight: 600;
                color: #ffffff;
                background: #7c3aed;
                padding: 0.25rem 0.75rem;
                border-radius: 9999px;
                margin-bottom: 0.75rem;
            }
            
            .resource-note {
                font-size: 0.9rem;
                color: #475569;
                font-style: italic;
                margin-bottom: 1rem;
                line-height: 1.5;
            }
            
            .resource-list {
                list-style: none;
            }
            
            .resource-item {
                display: flex;
                align-items: flex-start;
                gap: 0.5rem;
                margin-bottom: 0.75rem;
                color: #1e293b;
            }
            
            .resource-bullet {
                color: #3b82f6;
                font-weight: 700;
                flex-shrink: 0;
            }
            
            .resource-link {
                color: #1e40af;
                text-decoration: underline;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 0.25rem;
            }
            
            .resource-link:hover {
                color: #2563eb;
            }
            
            .resource-link:focus {
                outline: 2px solid #1e40af;
                outline-offset: 2px;
                border-radius: 2px;
            }
            
            .timer-container {
                background: #0f172a;
                border: 3px solid #475569;
                border-radius: 0.75rem;
                padding: 2rem;
                margin-bottom: 2rem;
            }
            
            .timer-buttons {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 0.75rem;
                margin-bottom: 2rem;
            }
            
            .timer-btn {
                padding: 0.875rem;
                background: #334155;
                color: #e2e8f0;
                border: 2px solid #475569;
                border-radius: 0.5rem;
                font-weight: 600;
                text-align: center;
            }
            
            .timer-btn:hover {
                background: #475569;
                border-color: #64748b;
            }
            
            .timer-btn:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .timer-display {
                text-align: center;
                padding: 2rem;
                background: #1e293b;
                border: 2px solid #475569;
                border-radius: 0.5rem;
                margin-bottom: 1.5rem;
            }
            
            .timer-value {
                font-size: 5rem;
                font-weight: 800;
                font-family: 'Courier New', monospace;
                color: #4ade80;
                line-height: 1;
                margin-bottom: 1rem;
            }
            
            .timer-value.warning {
                color: #f87171;
                animation: pulse 1s ease-in-out infinite;
            }
            
            .timer-label {
                font-size: 1rem;
                color: #94a3b8;
                text-transform: uppercase;
                letter-spacing: 0.1em;
            }
            
            .timer-controls {
                display: flex;
                gap: 1rem;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .timer-control-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                font-weight: 700;
                color: white;
                border: 3px solid;
                border-radius: 0.5rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .btn-start {
                background: #16a34a;
                border-color: #22c55e;
            }
            
            .btn-start:hover {
                background: #15803d;
            }
            
            .btn-start:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .btn-pause {
                background: #dc2626;
                border-color: #f87171;
            }
            
            .btn-pause:hover {
                background: #b91c1c;
            }
            
            .btn-pause:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .btn-reset {
                background: #ca8a04;
                border-color: #facc15;
            }
            
            .btn-reset:hover {
                background: #a16207;
            }
            
            .btn-reset:focus {
                outline: 3px solid #e8a838;
                outline-offset: 2px;
            }
            
            .flow-table {
                width: 100%;
                overflow-x: auto;
                margin-top: 1.5rem;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
                background: #0f172a;
                color: #fff;
                min-width: 800px;
            }
            
            thead tr {
                background: #1e293b;
                border-bottom: 2px solid #475569;
            }
            
            th {
                padding: 1rem;
                text-align: left;
                font-weight: 700;
                font-size: 0.95rem;
            }
            
            tbody tr {
                border-bottom: 1px solid #334155;
            }
            
            td {
                padding: 1rem;
                vertical-align: top;
            }
            
            td textarea {
                min-height: 80px;
                width: 100%;
                font-size: 0.9rem;
            }

            .team-roles {
                background: #0f172a;
                border: 2px solid #475569;
                border-radius: 0.5rem;
                padding: 1.5rem;
                margin-top: 2rem;
            }

            .team-roles h4 {
                color: #e8a838;
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }

            .role-item {
                display: grid;
                grid-template-columns: 200px 1fr;
                gap: 1rem;
                margin-bottom: 0.75rem;
                align-items: center;
            }

            .role-label {
                color: #93c5fd;
                font-weight: 600;
            }

            .glossary-term {
                color: #e8a838;
                font-weight: 600;
                border-bottom: 1px dotted #e8a838;
                cursor: help;
            }
            
            .text-white { color: #ffffff; }
            .text-yellow { color: #e8a838; }
            .text-green { color: #86efac; }
            .text-blue { color: #93c5fd; }
            .text-purple { color: #d8b4fe; }
            .text-orange { color: #fdba74; }
            .text-teal { color: #5eead4; }
            .text-red { color: #fca5a5; }
            .text-gray-light { color: #e2e8f0; }
            .text-gray { color: #cbd5e1; }
            
            .mb-1 { margin-bottom: 0.5rem; }
            .mb-2 { margin-bottom: 1rem; }
            .mb-3 { margin-bottom: 1.5rem; }
            .mb-4 { margin-bottom: 2rem; }
            .mt-1 { margin-top: 0.5rem; }
            .mt-2 { margin-top: 1rem; }
            .mt-3 { margin-top: 1.5rem; }
            .mt-4 { margin-top: 2rem; }
            
            .save-indicator {
                position: fixed;
                top: 1rem;
                right: 1rem;
                padding: 0.75rem 1.25rem;
                background: #16a34a;
                color: white;
                border-radius: 0.5rem;
                font-weight: 600;
                font-size: 0.9rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                opacity: 0;
                transition: opacity 0.3s ease;
                pointer-events: none;
                z-index: 1000;
            }
            
            .save-indicator.show {
                opacity: 1;
            }
            
            @media print {
                .container { 
                    background: white; 
                    padding: 0.5rem; 
                }
                
                .header-panel { 
                    border: 2px solid #000; 
                    background: white; 
                    padding: 1rem;
                    page-break-inside: avoid;
                }
                
                .logo-container, .intro-text, .button-group, .pulse-ring { 
                    display: none; 
                }
                
                h1 { 
                    color: #000 !important; 
                    font-size: 1.5rem;
                    text-shadow: none;
                }
                
                .subtitle {
                    color: #000 !important;
                }

                .getting-started, .progress-tracker, .dismiss-guide {
                    display: none;
                }
                
                .controls-panel, .section-panel { 
                    border: 1px solid #000; 
                    background: white; 
                    page-break-inside: avoid;
                    margin-bottom: 1rem;
                    box-shadow: none;
                }
                
                .section-header {
                    background: #f0f0f0 !important;
                    border-bottom: 1px solid #000;
                    padding: 0.5rem 1rem;
                }
                
                .section-title h2 { 
                    color: #000 !important; 
                    font-size: 1.1rem;
                }
                
                .section-title svg {
                    display: none;
                }
                
                .section-content {
                    padding: 1rem;
                }
                
                label { 
                    color: #000 !important; 
                    font-size: 0.9rem;
                }
                
                input, textarea, select { 
                    border: 1px solid #000; 
                    background: white; 
                    color: #000 !important;
                    padding: 0.5rem;
                    font-size: 0.9rem;
                    page-break-inside: avoid;
                }
                
                input:empty, textarea:empty, select:empty {
                    display: none;
                }
                
                .info-box { 
                    border: 1px solid #000; 
                    background: #f9f9f9;
                    color: #000 !important;
                    padding: 0.75rem;
                    font-size: 0.85rem;
                }
                
                .card {
                    border: 1px solid #000;
                    background: white;
                    padding: 0.75rem;
                    page-break-inside: avoid;
                }
                
                .card-title {
                    color: #000 !important;
                    font-size: 0.95rem;
                }
                
                .btn-primary, .btn-secondary, .btn-add, .btn-delete, 
                .btn-delete-example, .timer-controls, .button-group,
                .save-indicator, .example-badge, .resource-grid,
                details, .timer-container, .timer-buttons, .timer-display,
                .team-roles, .flow-table {
                    display: none !important;
                }
                
                .progress-icon svg {
                    display: inline;
                }
                
                .card[data-has-content="false"] {
                    display: none;
                }
                
                * {
                    color-adjust: exact;
                    -webkit-print-color-adjust: exact;
                    print-color-adjust: exact;
                }
            }
        `;

        class NuclearDebatePrep extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                
                // Initialize state with 2 example entries
                this.state = {
                    position: 'pro',
                    selectedPlant: '',
                    showGettingStarted: true,
                    expandedSections: {
                        research: true,
                        searchStrategy: false,
                        arguments: true,
                        evidence: true,
                        rubric: false,
                        factCheck: false,
                        fallacies: false,
                        debateFlow: false,
                        prep: false
                    },
                    researchNotes: {
                        intro: '', 
                        plant: '', 
                        operations: '', 
                        environmental: '', 
                        economic: '', 
                        future: ''
                    },
                    arguments: [
                        {
                            claim: 'Nuclear power is essential for reducing carbon emissions',
                            data: 'Salem and Hope Creek plants prevent 10 million tons of COâ‚‚ per year',
                            warrant: 'We need low-carbon energy sources now, and nuclear provides reliable power 24/7 unlike solar and wind',
                            qualifier: 'Based on current technology and NJ climate goals',
                            rebuttal: 'Some say renewables can do this job, but they need backup power for cloudy/windless days',
                            source: '',
                            isExample: true
                        }
                    ],
                    counterArgs: [
                        {
                            opposing: 'Nuclear waste stays dangerous for thousands of years',
                            understanding: 'They have a pointâ€”high-level waste does remain radioactive for a very long time, and we don\'t have a permanent storage solution yet',
                            rebuttal: 'True, but the amount is very small (a soda can per person per lifetime), and dry cask storage has worked safely for decades',
                            isExample: true
                        }
                    ],
                    evidence: [
                        {
                            claim: 'Nuclear has the lowest death rate per unit of energy produced',
                            source: 'Our World in Data, University of Oxford research',
                            citation: '',
                            citationType: 'mla',
                            currency: '5',
                            relevance: '5',
                            authority: '5',
                            accuracy: '5',
                            purpose: '5',
                            reliability: 'University research project, peer-reviewed data, no financial stake in nuclear industry',
                            isExample: true
                        },
                        {
                            claim: 'Renewable energy is becoming cheaper than nuclear',
                            source: 'Lazard\'s Levelized Cost of Energy Analysis',
                            citation: '',
                            citationType: 'mla',
                            currency: '5',
                            relevance: '4',
                            authority: '4',
                            accuracy: '5',
                            purpose: '4',
                            reliability: 'Financial advisory firm, annual report used by industry, generally credible but check for context on what costs are included',
                            isExample: true
                        }
                    ],
                    evidenceAgainst: [],
                    questions: [],
                    flow: [],
                    teamRoles: {
                        opening: '',
                        mainArgs: '',
                        crossEx: '',
                        closing: '',
                        researcher: '',
                        strategy: ''
                    },
                    openingStatement: '',
                    closingStatement: '',
                    timerActive: false,
                    timerSeconds: 120,
                    timerMode: 'opening'
                };

                this.timerInterval = null;
                this.storageKey = 'nuclear-debate-prep-hs-edition';
                this.saveTimeout = null;
                
                // CORRECTED plant data with verified 2026 information
                this.plants = {
                    nj: [{
                        name: 'Salem + Hope Creek',
                        operator: 'PSEG Nuclear',
                        state: 'New Jersey',
                        reactors: 'Salem 1 & 2 (PWR type), Hope Creek (BWR type)',
                        capacity: '3,457 MW total',
                        keyFacts: 'Largest nuclear facility on East Coast; provides about 42% of NJ electricity. Operated by PSEG Nuclear (Constellation is minority owner of Salem units). Licensed: Salem 1 to 2036, Salem 2 to 2040, Hope Creek to 2046.'
                    }],
                    ny: [
                        {
                            name: 'James A. FitzPatrick',
                            operator: 'Constellation Energy',
                            state: 'New York',
                            reactors: 'BWR type',
                            capacity: '848 MW',
                            keyFacts: 'Was nearly closed in 2017 but purchased by Exelon (now Constellation Energy) and continues operating. Compare to Indian Point which closed in 2020-2021.'
                        },
                        {
                            name: 'Ginna',
                            operator: 'Constellation Energy',
                            state: 'New York',
                            reactors: 'PWR type',
                            capacity: '581 MW',
                            keyFacts: 'Oldest operating nuclear plant in NY (since 1970); serves Rochester area. Current license through 2029; Constellation seeking extension to 80 years of operation.'
                        },
                        {
                            name: 'Nine Mile Point Unit 1',
                            operator: 'Constellation Energy',
                            state: 'New York',
                            reactors: 'BWR type',
                            capacity: '613 MW',
                            keyFacts: 'Part of two-unit Nine Mile Point station. Operating since 1969. Current license to 2029; Constellation filed for extension to 2049 in early 2026.'
                        },
                        {
                            name: 'Nine Mile Point Unit 2',
                            operator: 'Constellation Energy',
                            state: 'New York',
                            reactors: 'BWR type',
                            capacity: '1,287 MW',
                            keyFacts: 'Newer, larger unit at Nine Mile Point (1988). Licensed through 2046.'
                        }
                    ]
                };
                
                // CORRECTED Research resources with EIA and IPCC added
                this.researchResources = [
                    { 
                        category: 'Nuclear Power Plant Information', 
                        authorityLevel: 'Government Sources',
                        evaluationNote: 'Official government data on safety, operations, and regulations. Very reliable for facts, but won\'t tell you what policies should be.',
                        items: [
                            { name: 'U.S. Nuclear Regulatory Commission', url: 'https://www.nrc.gov' },
                            { name: 'NRC Plant Database', url: 'https://www.nrc.gov/reactors/operating/list-power-reactor-units.html' },
                            { name: 'Department of Energy', url: 'https://www.energy.gov/ne/nuclear-energy' },
                            { name: 'U.S. Energy Information Administration (EIA)', url: 'https://www.eia.gov' },
                            { name: 'NY State Energy (NYSERDA)', url: 'https://www.nyserda.ny.gov' },
                            { name: 'NJ Public Utilities', url: 'https://www.nj.gov/bpu/' }
                        ]
                    },
                    { 
                        category: 'Library Databases: Different Viewpoints', 
                        authorityLevel: 'Curated Collections',
                        evaluationNote: 'These databases give you pro AND con perspectives. Great starting point, but always track down original sources.',
                        items: [
                            { name: 'Gale in Context: Global Issues', url: 'https://link.gale.com/apps/GIC?u=nort87507' },
                            { name: 'Gale in Context: Opposing Viewpoints', url: 'https://link.gale.com/apps/OVIC?u=nort87507' },
                            { name: 'Infobase Issues & Controversies', url: 'https://online.infobaselearning.com/Direct.aspx?pid=WE57&aid=17282' },
                            { name: 'EBSCOhost Points of View', url: 'https://research.ebsco.com/c/t3bsam?db=pwh' }
                        ]
                    },
                    { 
                        category: 'Library Databases: Science', 
                        authorityLevel: 'Science & Tech',
                        evaluationNote: 'Good for understanding how nuclear energy actually works. Look for recent articles.',
                        items: [
                            { name: 'Grolier ScienceFlix', url: 'http://scienceflix.digital.scholastic.com/' },
                            { name: 'Infobase Science Online', url: 'https://online.infobaselearning.com/Direct.aspx?pid=WE40&aid=17282' },
                            { name: 'EBSCOhost Science Reference', url: 'https://research.ebsco.com/c/t3bsam?db=sch' }
                        ]
                    },
                    { 
                        category: 'Climate & Energy Data', 
                        authorityLevel: 'Scientific Research',
                        evaluationNote: 'International climate science and energy data. The IPCC is the gold standard for climate information.',
                        items: [
                            { name: 'IPCC (Intergovernmental Panel on Climate Change)', url: 'https://www.ipcc.ch' },
                            { name: 'EIA Energy Data & Analysis', url: 'https://www.eia.gov/nuclear/' }
                        ]
                    },
                    { 
                        category: 'News & General Info', 
                        authorityLevel: 'Current Events',
                        evaluationNote: 'Useful for recent news, but news articles aren\'t the same as research studies. Check what sources they cite.',
                        items: [
                            { name: 'Britannica School', url: 'http://school.eb.com/' },
                            { name: 'New York Times', url: 'https://www.nytimes.com' },
                            { name: 'Google Scholar', url: 'https://scholar.google.com' }
                        ]
                    },
                    { 
                        category: 'Different Perspectives', 
                        authorityLevel: 'Various Groups',
                        evaluationNote: 'These represent different viewpoints. The key: know who\'s behind each source and what their angle is.',
                        items: [
                            { name: 'International Atomic Energy Agency', url: 'https://www.iaea.org' },
                            { name: 'Union of Concerned Scientists', url: 'https://www.ucsusa.org/nuclear-power' },
                            { name: 'Nuclear Energy Institute (industry group)', url: 'https://www.nei.org' },
                            { name: 'World Nuclear Association', url: 'https://www.world-nuclear.org' },
                            { name: 'EPA Nuclear Info', url: 'https://www.epa.gov/radtown/nuclear-power-plants' }
                        ]
                    }
                ];
            }

            connectedCallback() {
                this.loadState();
                this.render();
                this.setupTimer();
            }

            disconnectedCallback() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                if (this.saveTimeout) {
                    clearTimeout(this.saveTimeout);
                }
            }

            loadState() {
                try {
                    const saved = localStorage.getItem(this.storageKey);
                    const guideDismissed = localStorage.getItem(this.storageKey + '-guide-dismissed');
                    
                    if (saved) {
                        const data = JSON.parse(saved);
                        // Merge saved data but keep example entries if starting fresh
                        if (data.arguments && data.arguments.length > 0) {
                            this.state = { ...this.state, ...data };
                        }
                    }
                    
                    if (guideDismissed === 'true') {
                        this.state.showGettingStarted = false;
                    }
                } catch (e) {
                    console.warn('Could not load saved data:', e);
                }
            }

            saveState() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.state));
                    this.showSaveIndicator();
                } catch (e) {
                    console.warn('Could not save data:', e);
                }
            }

            debouncedSave() {
                if (this.saveTimeout) {
                    clearTimeout(this.saveTimeout);
                }
                this.saveTimeout = setTimeout(() => {
                    this.saveState();
                }, 1000);
            }

            showSaveIndicator() {
                const indicator = this.shadowRoot.querySelector('.save-indicator');
                if (indicator) {
                    indicator.classList.add('show');
                    setTimeout(() => {
                        indicator.classList.remove('show');
                    }, 2000);
                }
            }

            dismissGettingStarted() {
                this.state.showGettingStarted = false;
                localStorage.setItem(this.storageKey + '-guide-dismissed', 'true');
                this.render();
            }

            getProgress() {
                const hasPosition = !!this.state.selectedPlant;
                const researchComplete = Object.values(this.state.researchNotes).filter(n => n.trim().length > 0).length >= 4;
                const hasArguments = this.state.arguments.filter(a => !a.isExample && a.claim).length >= 2;
                const hasCounterArgs = this.state.counterArgs.filter(c => !c.isExample && c.opposing).length >= 2;
                const hasEvidence = this.state.evidence.filter(e => !e.isExample && e.claim).length >= 3;
                const hasStatements = this.state.openingStatement.trim().length > 0 || this.state.closingStatement.trim().length > 0;
                
                return {
                    hasPosition,
                    researchComplete,
                    hasArguments,
                    hasCounterArgs,
                    hasEvidence,
                    hasStatements
                };
            }

            printCheatSheet() {
                const nonExampleArgs = this.state.arguments.filter(a => !a.isExample);
                const nonExampleEvidence = this.state.evidence.filter(e => !e.isExample);
                const nonExampleCounterArgs = this.state.counterArgs.filter(c => !c.isExample);
                
                const cheatSheet = `
<!DOCTYPE html>
<html>
<head>
    <title>Debate Cheat Sheet - ${this.state.position.toUpperCase()}</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        h1 { font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid #000; }
        h2 { font-size: 14px; margin-top: 15px; margin-bottom: 5px; }
        .section { margin-bottom: 15px; }
        .item { margin-bottom: 8px; font-size: 12px; }
        .label { font-weight: bold; }
        @media print { 
            body { padding: 10px; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <button class="no-print" onclick="window.print()" style="margin-bottom: 10px; padding: 10px 20px;">Print This Sheet</button>
    
    <h1>Nuclear Power Debate Cheat Sheet</h1>
    <p><strong>Position:</strong> ${this.state.position.toUpperCase()} | <strong>Plant:</strong> ${this.state.selectedPlant || 'Not selected'}</p>
    
    <div class="section">
        <h2>Main Arguments (Claims Only)</h2>
        ${nonExampleArgs.map((arg, i) => `
            <div class="item">${i + 1}. ${arg.claim || 'Not yet written'}</div>
        `).join('')}
    </div>
    
    <div class="section">
        <h2>Top Evidence Sources</h2>
        ${nonExampleEvidence.slice(0, 5).map((ev, i) => `
            <div class="item">
                <div><span class="label">${i + 1}. Claim:</span> ${ev.claim}</div>
                <div><span class="label">Source:</span> ${ev.source}</div>
                ${ev.citation ? `<div><span class="label">Citation:</span> ${ev.citation}</div>` : ''}
            </div>
        `).join('')}
    </div>
    
    <div class="section">
        <h2>Counter-Arguments to Address</h2>
        ${nonExampleCounterArgs.slice(0, 3).map((c, i) => `
            <div class="item">
                <div><span class="label">${i + 1}. They'll say:</span> ${c.opposing}</div>
                <div><span class="label">We respond:</span> ${c.rebuttal || 'Prepare response'}</div>
            </div>
        `).join('')}
    </div>
    
    <div class="section">
        <h2>Opening Hook</h2>
        <div class="item">${this.state.openingStatement ? this.state.openingStatement.substring(0, 200) + '...' : 'Write your opening'}</div>
    </div>
    
    <div class="section">
        <h2>Closing Line</h2>
        <div class="item">${this.state.closingStatement ? this.state.closingStatement.substring(this.state.closingStatement.length - 200) : 'Write your closing'}</div>
    </div>
    
    <div class="section">
        <h2>Debate Timer Schedule</h2>
        <div class="item">Opening: 2 minutes | Main Arguments: 4 minutes | Cross-Exam: 3 minutes | Closing: 2 minutes</div>
    </div>
</body>
</html>
                `;
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(cheatSheet);
                printWindow.document.close();
            }

            setupTimer() {
                this.timerInterval = setInterval(() => {
                    if (this.state.timerActive && this.state.timerSeconds > 0) {
                        this.state.timerSeconds--;
                        this.updateTimerDisplay();
                        
                        if (this.state.timerSeconds === 0) {
                            this.state.timerActive = false;
                            this.updateControlButtons();
                        }
                    }
                }, 1000);
            }

            updateTimerDisplay() {
                const display = this.shadowRoot.querySelector('.timer-value');
                if (display) {
                    const mins = Math.floor(this.state.timerSeconds / 60);
                    const secs = (this.state.timerSeconds % 60).toString().padStart(2, '0');
                    display.textContent = `${mins}:${secs}`;
                    
                    if (this.state.timerSeconds <= 30 && this.state.timerActive) {
                        display.classList.add('warning');
                    } else {
                        display.classList.remove('warning');
                    }
                }
            }

            updateControlButtons() {
                const controls = this.shadowRoot.querySelector('.timer-controls');
                if (controls) {
                    const buttons = this.state.timerActive ? 
                        `<button class="timer-control-btn btn-pause" data-action="pause" aria-label="Pause timer">Pause</button>` :
                        `<button class="timer-control-btn btn-start" data-action="start" aria-label="Start timer">Start</button>`;
                    controls.innerHTML = `${buttons}<button class="timer-control-btn btn-reset" data-action="reset" aria-label="Reset timer">Reset</button>`;
                    this.attachTimerControls();
                }
            }

            getPlantInfo() {
                const allPlants = [...this.plants.nj, ...this.plants.ny];
                return allPlants.find(p => p.name === this.state.selectedPlant);
            }

            toggleSection(section) {
                this.state.expandedSections[section] = !this.state.expandedSections[section];
                this.render();
                
                requestAnimationFrame(() => {
                    const button = this.shadowRoot.querySelector(`[data-toggle="${section}"]`);
                    if (button) {
                        button.focus();
                        button.setAttribute('aria-expanded', this.state.expandedSections[section].toString());
                    }
                });
            }

            renderHeader() {
                return `
                    <div class="header-panel">
                        <div class="logo-container">
                            <div class="logo-circle" aria-hidden="true">
                                ${icons.Scale}
                                <div class="pulse-ring"></div>
                            </div>
                            <div>
                                <h1>NUCLEAR DEBATE PREP</h1>
                                <div class="subtitle">Research & Argument Builder</div>
                            </div>
                        </div>
                        <p class="intro-text">
                            This tool helps you research nuclear power and build strong, fair arguments for your debate. 
                            Nuclear power is complicated; experts disagree about it. Your goal is to show you've done solid research 
                            and can defend your position thoughtfully.
                        </p>
                        <div class="button-group">
                            <button class="btn-primary" data-action="print" aria-label="Print your work">
                                ${icons.Printer} Print Full Work
                            </button>
                            <button class="btn-secondary" data-action="print-cheat" aria-label="Print one-page cheat sheet">
                                ${icons.FileText} Print Cheat Sheet
                            </button>
                        </div>
                    </div>
                `;
            }

            renderGettingStarted() {
                if (!this.state.showGettingStarted) return '';
                
                return `
                    <div class="getting-started">
                        <button class="dismiss-guide" data-action="dismiss-guide" aria-label="Dismiss getting started guide">
                            ${icons.X}
                        </button>
                        <h3>Where to Begin</h3>
                        <ol>
                            <li>Pick your side and plant</li>
                            <li>Read the "Research Your Topic" section. Fill in those notes first.</li>
                            <li>Move to "Build Your Arguments," using the examples as models.</li>
                            <li>Check your sources in "Track Your Evidence."</li>
                            <li>Practice with the timer before debate day!</li>
                        </ol>
                        <p>Remember to delete the example entries once you understand the format.</p>
                    </div>
                `;
            }

            renderProgress() {
                const progress = this.getProgress();
                
                return `
                    <div class="progress-tracker">
                        <h3>Your Progress</h3>
                        <div class="progress-items">
                            <div class="progress-item ${progress.hasPosition ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.hasPosition ? icons.CheckCircle : icons.Circle}
                                </span>
                                Position & plant selected
                            </div>
                            <div class="progress-item ${progress.researchComplete ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.researchComplete ? icons.CheckCircle : icons.Circle}
                                </span>
                                Research notes (4+ sections)
                            </div>
                            <div class="progress-item ${progress.hasArguments ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.hasArguments ? icons.CheckCircle : icons.Circle}
                                </span>
                                At least 2 arguments built
                            </div>
                            <div class="progress-item ${progress.hasCounterArgs ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.hasCounterArgs ? icons.CheckCircle : icons.Circle}
                                </span>
                                At least 2 counter-arguments
                            </div>
                            <div class="progress-item ${progress.hasEvidence ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.hasEvidence ? icons.CheckCircle : icons.Circle}
                                </span>
                                At least 3 evidence sources
                            </div>
                            <div class="progress-item ${progress.hasStatements ? 'complete' : ''}">
                                <span class="progress-icon">
                                    ${progress.hasStatements ? icons.CheckCircle : icons.Circle}
                                </span>
                                Opening/closing drafted
                            </div>
                        </div>
                    </div>
                `;
            }

            renderControls() {
                const plantInfo = this.getPlantInfo();
                return `
                    <div class="controls-panel">
                        <div class="grid-2 mb-3">
                            <div>
                                <label for="position-select">Your Debate Side</label>
                                <select id="position-select" data-bind="position" aria-describedby="position-help">
                                    <option value="pro" ${this.state.position === 'pro' ? 'selected' : ''}>PRO: Support Nuclear Energy</option>
                                    <option value="con" ${this.state.position === 'con' ? 'selected' : ''}>CON: Oppose Nuclear Energy</option>
                                </select>
                                <p id="position-help" class="help-text">
                                    Which side will your team argue?
                                </p>
                            </div>
                            <div>
                                <label for="plant-select">Choose a Nuclear Plant</label>
                                <select id="plant-select" data-bind="selectedPlant" aria-describedby="plant-help">
                                    <option value="">Pick one to research...</option>
                                    <optgroup label="New Jersey">
                                        ${this.plants.nj.map(p => `
                                            <option value="${p.name}" ${this.state.selectedPlant === p.name ? 'selected' : ''}>
                                                ${p.name} (${p.operator})
                                            </option>
                                        `).join('')}
                                    </optgroup>
                                    <optgroup label="New York">
                                        ${this.plants.ny.map(p => `
                                            <option value="${p.name}" ${this.state.selectedPlant === p.name ? 'selected' : ''}>
                                                ${p.name} (${p.operator})
                                            </option>
                                        `).join('')}
                                    </optgroup>
                                </select>
                                <p id="plant-help" class="help-text">
                                    Select a specific plant to research
                                </p>
                            </div>
                        </div>
                        ${this.state.selectedPlant && plantInfo ? `
                            <div class="info-box info-box-blue">
                                <strong>Quick Facts: ${this.state.selectedPlant}</strong><br>
                                <strong>Who runs it:</strong> ${plantInfo.operator}<br>
                                <strong>Type:</strong> ${plantInfo.reactors}<br>
                                <strong>Power output:</strong> ${plantInfo.capacity}<br>
                                <strong>Current status:</strong> ${plantInfo.keyFacts}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderResearchSection() {
                if (!this.state.expandedSections.research) return '';
                
                const components = [
                    { 
                        key: 'intro', 
                        label: 'Nuclear Power Basics', 
                        bullets: [
                            'What is nuclear fission? (How does splitting atoms create energy?)',
                            'Most natural uranium is U-238, which can\'t sustain fission. Power plants need <strong>enriched uranium</strong> with higher U-235 (the fissile isotope). This is why uranium must be enriched from ~0.7% U-235 to 3-5% U-235. <a href="https://www.nrc.gov/materials/fuel-cycle-fac/ur-enrichment.html" target="_blank" rel="noopener noreferrer" class="source-link">Source: NRC</a>',
                            'How does a reactor turn that energy into electricity? Importantly, water acts as both a <strong>coolant</strong> (removing heat) and a <strong>moderator</strong> (slowing neutrons to sustain the chain reaction). <a href="https://www.energy.gov/ne/articles/nuclear-101-how-does-nuclear-reactor-work" target="_blank" rel="noopener noreferrer" class="source-link">Source: DOE</a>',
                            'âš ï¸ NOTE: Power plants use FISSION (splitting atoms). FUSION (combining atoms, like the sun) is still experimental. If you see "fusion breakthrough" news, that\'s different tech.',
                            'List 3 reasons people SUPPORT nuclear power',
                            'List 3 reasons people OPPOSE nuclear power'
                        ]
                    },
                    { 
                        key: 'plant', 
                        label: this.state.selectedPlant ? `About ${this.state.selectedPlant}` : 'About Your Plant',
                        bullets: this.state.selectedPlant ? [
                            'When was it built?',
                            'Where exactly is it located?',
                            'What kind of reactor does it use? (PWR = Pressurized Water Reactor, BWR = Boiling Water Reactor)',
                            'Any major events in its history? (upgrades, problems, close calls?)',
                            'Compare: Why did Indian Point (NY) close in 2020-2021 (Unit 2 April 2020, Unit 3 April 2021) while your plant stayed open?',
                            'âœ“ VERIFY: For most current status and license dates, check <a href="https://www.nrc.gov/reactors/operating/list-power-reactor-units.html" target="_blank" rel="noopener noreferrer" class="source-link">NRC database</a>'
                        ] : ['Select a plant above to see research questions']
                    },
                    { 
                        key: 'operations', 
                        label: 'How It Works',
                        bullets: [
                            'What type of reactor does it use?',
                            'How much electricity does it produce?',
                            'What is its capacity factor (% of time running at full power)? Nuclear is usually around 90%. <a href="https://www.eia.gov/electricity/monthly/epm_table_grapher.php?t=epmt_6_07_a" target="_blank" rel="noopener noreferrer" class="source-link">Source: EIA</a>',
                            'What safety systems does it have?',
                            'What happens in an emergency?'
                        ]
                    },
                    { 
                        key: 'environmental', 
                        label: 'Environment & Health',
                        bullets: [
                            'How does it affect local water? (temperature, usage)',
                            'Where does the nuclear waste go? How is it stored? Note: High-level waste is currently stored on-site in dry cask storage because deep geological repositories (like Yucca Mountain) remain politically stalled. <a href="https://www.nrc.gov/waste/spent-fuel-storage.html" target="_blank" rel="noopener noreferrer" class="source-link">Source: NRC</a>',
                            'Have there been any safety problems or violations?',
                            'How does it compare to coal/gas/solar/wind for lifecycle carbon emissions? Nuclear: ~12g COâ‚‚/kWh, Coal: ~820g, Gas: ~490g, Solar: ~40g, Wind: ~11g. <a href="https://www.ipcc.ch/report/ar6/wg3/" target="_blank" rel="noopener noreferrer" class="source-link">Source: IPCC AR6</a>',
                            'Nuclear has one of the lowest death rates per unit of energy: 0.07 deaths per terawatt-hour (TWh), comparable to wind and solar. Coal causes ~25 deaths/TWh. <a href="https://ourworldindata.org/safest-sources-of-energy" target="_blank" rel="noopener noreferrer" class="source-link">Source: Our World in Data</a>',
                            'How much land does it use compared to other energy sources?'
                        ]
                    },
                    { 
                        key: 'economic', 
                        label: 'Money & Community',
                        bullets: [
                            'How many jobs does it provide?',
                            'How much does it cost to run? (You\'ll see different cost numbersâ€”check if they mean running an EXISTING plant like yours OR building a brand NEW one from scratch. That\'s why people disagree!)',
                            'Does it get Zero Emission Credits (ZECs)â€”money from NY or NJ to keep running because it doesn\'t emit carbon? How much? <a href="https://www.nyserda.ny.gov/zec" target="_blank" rel="noopener noreferrer" class="source-link">NY ZECs</a>',
                            'What does the local community think about it?',
                            'What if it closed? (jobs, electricity prices, replacement power)'
                        ]
                    },
                    { 
                        key: 'future', 
                        label: 'Future Plans',
                        bullets: [
                            'Is it staying open or closing? When does its license expire?',
                            'Are there plans for new nuclear plants in NY/NJ? Note: Small Modular Reactors (SMRs) are factory-built, smaller reactors designed to address high capital costs of traditional large reactors. <a href="https://www.energy.gov/ne/advanced-small-modular-reactors-smrs" target="_blank" rel="noopener noreferrer" class="source-link">Source: DOE</a>',
                            'What are NY and NJ climate goals? Does nuclear fit in?',
                            'Could renewable energy replace this plant? When?',
                            'What happens if it closes? Decommissioning takes 10-15 years and costs $2-3 billion (see Indian Point: ~$2.3B via Holtec contract). <a href="https://www.eia.gov/todayinenergy/detail.php?id=40212" target="_blank" rel="noopener noreferrer" class="source-link">Source: EIA</a>'
                        ]
                    }
                ];

                return `
                    <div class="section-content">
                        <div class="info-box info-box-blue">
                            <strong>How to Research Well:</strong> This is a real debate where smart people disagree. 
                            Your job isn't to prove you're 100% rightâ€”it's to show you've researched well and can 
                            back up your arguments. Use different types of sources: government data for facts, 
                            news for current events, and research studies for deeper analysis.
                        </div>

                        <div class="info-box info-box-yellow">
                            <strong>Can't Access Databases from Home?</strong> Use the crendtials<a href="https://docs.google.com/document/d/1oGCj_JLUUAQV9jOgOQpNmrZlYmntAysr68tuXCWGCy4/view" target="_blank" rel="noopener noreferrer" class="source-link">available here!</a>
                        </div>

                        <h3 class="text-white mb-2" style="font-size: 1.3rem; font-weight: 700;">Where to Look</h3>
                        <div class="resource-grid">
                            ${this.researchResources.map(category => `
                                <div class="resource-card">
                                    <h4>${category.category}</h4>
                                    <span class="resource-authority">${category.authorityLevel}</span>
                                    <p class="resource-note">${category.evaluationNote}</p>
                                    <ul class="resource-list">
                                        ${category.items.map(item => `
                                            <li class="resource-item">
                                                <span class="resource-bullet">â€¢</span>
                                                <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="resource-link">
                                                    ${item.name} ${icons.ExternalLink}
                                                </a>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>

                        ${components.map((comp) => `
                            <div class="mt-4">
                                <label for="research-${comp.key}">${comp.label}</label>
                                <div class="info-box info-box-green" style="margin-bottom: 1rem;">
                                    <strong>Find out:</strong>
                                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        ${comp.bullets.map(bullet => `<li style="margin-bottom: 0.25rem;">${bullet}</li>`).join('')}
                                    </ul>
                                </div>
                                <textarea 
                                    id="research-${comp.key}"
                                    data-bind="researchNotes.${comp.key}" 
                                    placeholder="Write your research notes here..."
                                    aria-label="Research notes for ${comp.label}"
                                >${this.escapeHtml(this.state.researchNotes[comp.key])}</textarea>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            renderSearchStrategy() {
                if (!this.state.expandedSections.searchStrategy) return '';
                
                return `
                    <div class="section-content">
                        <div class="info-box info-box-purple">
                            <strong>Search Smarter:</strong> Use these strategies to find better sources faster in library databases.
                        </div>

                        <div class="grid-2">
                            <div class="card card-green">
                                <h4 class="card-title">Good Search Terms</h4>
                                <ul class="text-white" style="list-style: none;">
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong>nuclear power</strong> OR <strong>nuclear energy</strong></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong>reactor safety</strong></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong>nuclear waste</strong> OR <strong>radioactive waste</strong></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong>carbon emissions</strong></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong>renewable energy</strong></li>
                                </ul>
                            </div>

                            <div class="card card-purple">
                                <h4 class="card-title">Search Tricks</h4>
                                <ul class="text-white" style="list-style: none;">
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong class="text-orange">AND</strong> makes it more specific: <em class="text-gray">nuclear AND safety</em></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong class="text-orange">OR</strong> gives you more results: <em class="text-gray">reactor OR plant</em></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong class="text-orange">"quotes"</strong> finds exact phrases: <em class="text-gray">"climate change"</em></li>
                                    <li class="mb-2"><span class="text-yellow">â–¸</span> <strong class="text-orange">NOT</strong> excludes stuff: <em class="text-gray">nuclear NOT weapons</em></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderArguments() {
                if (!this.state.expandedSections.arguments) return '';
                
                return `
                    <div class="section-content">
                        <div class="info-box info-box-green">
                            <strong>How to Build a Strong Argument:</strong> Every good argument needs five parts:
                            <strong>(1)</strong> Your main point, 
                            <strong>(2)</strong> Evidence to back it up, 
                            <strong>(3)</strong> Explanation of why your evidence proves your point, 
                            <strong>(4)</strong> How sure you are (don't oversell!), and
                            <strong>(5)</strong> What the other side might say back.
                        </div>

                        <h3 class="text-yellow mb-3" style="font-size: 1.3rem; font-weight: 700;">Your Team's Arguments</h3>
                        ${this.state.arguments.map((arg, index) => `
                            <div class="card card-blue">
                                <div class="card-header">
                                    <span class="card-title">
                                        ARGUMENT ${index + 1}
                                        ${arg.isExample ? `
                                            <span class="example-badge">
                                                âš ï¸ EXAMPLE
                                                <button class="btn-delete-example" data-action="delete-example-arg" data-index="${index}">
                                                    ${icons.X} Delete
                                                </button>
                                            </span>
                                        ` : ''}
                                    </span>
                                    ${!arg.isExample ? `
                                        <button class="btn-delete" data-action="delete-arg" data-index="${index}" aria-label="Delete argument ${index + 1}">
                                            ${icons.Trash2} Delete
                                        </button>
                                    ` : ''}
                                </div>
                                
                                <label class="inline" for="arg-${index}-claim">1. Your Main Point</label>
                                <input 
                                    id="arg-${index}-claim"
                                    type="text" 
                                    value="${this.escapeHtml(arg.claim || '')}" 
                                    placeholder="What are you arguing?"
                                    data-bind="arguments.${index}.claim"
                                />
                                
                                <label class="inline" for="arg-${index}-data" style="margin-top: 1rem;">2. Evidence (facts, stats, expert quotes)</label>
                                <textarea 
                                    id="arg-${index}-data"
                                    placeholder="What proves your point? Be specific with numbers and sources."
                                    data-bind="arguments.${index}.data"
                                    class="compact"
                                >${this.escapeHtml(arg.data || '')}</textarea>
                                
                                <label class="inline" for="arg-${index}-warrant" style="margin-top: 1rem;">3. Why Does This Evidence Prove Your Point?</label>
                                <textarea 
                                    id="arg-${index}-warrant"
                                    placeholder="Connect the dotsâ€”explain the logic."
                                    data-bind="arguments.${index}.warrant"
                                    class="compact"
                                >${this.escapeHtml(arg.warrant || '')}</textarea>
                                
                                <label class="inline" for="arg-${index}-qualifier" style="margin-top: 1rem;">4. How Sure Are You? (Be honest!)</label>
                                <input 
                                    id="arg-${index}-qualifier"
                                    type="text" 
                                    value="${this.escapeHtml(arg.qualifier || '')}" 
                                    placeholder='Like: "based on current tech" or "in most cases" or "until 2030"'
                                    data-bind="arguments.${index}.qualifier"
                                />
                                
                                <label class="inline" for="arg-${index}-rebuttal" style="margin-top: 1rem;">5. What Might They Say Back?</label>
                                <textarea 
                                    id="arg-${index}-rebuttal"
                                    placeholder="Think aheadâ€”what will the other team argue?"
                                    data-bind="arguments.${index}.rebuttal"
                                    class="compact"
                                >${this.escapeHtml(arg.rebuttal || '')}</textarea>
                                
                                <label class="inline" for="arg-${index}-source" style="margin-top: 1rem;">Source (where'd you find this?)</label>
                                <input 
                                    id="arg-${index}-source"
                                    type="text" 
                                    value="${this.escapeHtml(arg.source || '')}" 
                                    placeholder="Full citation in MLA or Chicago format"
                                    data-bind="arguments.${index}.source"
                                />
                            </div>
                        `).join('')}
                        <button class="btn-add" data-action="add-arg" aria-label="Add new argument">
                            ${icons.Plus} Add Another Argument
                        </button>

                        <h3 class="text-yellow mb-3 mt-4" style="font-size: 1.3rem; font-weight: 700;">Understanding the Other Side</h3>
                        <p class="text-gray-light mb-3" style="font-style: italic;">
                            Don't make a straw man! State their argument fairly and try to understand why they believe it. 
                            <strong>Then</strong> explain where you disagree and why. This makes you look fair and smart.
                        </p>
                        ${this.state.counterArgs.map((counter, index) => `
                            <div class="card card-orange">
                                <div class="card-header">
                                    <span class="card-title">
                                        COUNTER-ARGUMENT ${index + 1}
                                        ${counter.isExample ? `
                                            <span class="example-badge">
                                                âš ï¸ EXAMPLE
                                                <button class="btn-delete-example" data-action="delete-example-counter" data-index="${index}">
                                                    ${icons.X} Delete
                                                </button>
                                            </span>
                                        ` : ''}
                                    </span>
                                    ${!counter.isExample ? `
                                        <button class="btn-delete" data-action="delete-counter" data-index="${index}" aria-label="Delete counter-argument ${index + 1}">
                                            ${icons.Trash2} Delete
                                        </button>
                                    ` : ''}
                                </div>
                                <label class="inline" for="counter-${index}-opposing">What Will They Argue?</label>
                                <input 
                                    id="counter-${index}-opposing"
                                    type="text" 
                                    value="${this.escapeHtml(counter.opposing || '')}" 
                                    placeholder="State their argument fairlyâ€”no exaggerating!"
                                    data-bind="counterArgs.${index}.opposing"
                                />
                                <label class="inline" for="counter-${index}-understanding" style="margin-top: 1rem;">Why Do They Think This? (Try to see their point)</label>
                                <textarea 
                                    id="counter-${index}-understanding"
                                    placeholder="What makes their argument reasonable? What evidence do they have?"
                                    data-bind="counterArgs.${index}.understanding"
                                    class="compact"
                                >${this.escapeHtml(counter.understanding || '')}</textarea>
                                <label class="inline" for="counter-${index}-rebuttal" style="margin-top: 1rem;">Your Response (where you disagree and why)</label>
                                <textarea 
                                    id="counter-${index}-rebuttal"
                                    placeholder="Now explain why your evidence is stronger or why their logic doesn't work."
                                    data-bind="counterArgs.${index}.rebuttal"
                                >${this.escapeHtml(counter.rebuttal || '')}</textarea>
                            </div>
                        `).join('')}
                        <button class="btn-add" data-action="add-counter" aria-label="Add new counter-argument">
                            ${icons.Plus} Add Counter-Argument
                        </button>
                    </div>
                `;
            }

            renderEvidence() {
                if (!this.state.expandedSections.evidence) return '';
                
                return `
                    <div class="section-content">
                        <div class="info-box info-box-purple">
                            <strong>How to Check if a Source is Good:</strong> Rate each source on 5 things: 
                            Is it <strong>recent</strong>? Is it <strong>relevant</strong> to nuclear power? 
                            Is the author an <strong>expert</strong>? Can you <strong>verify</strong> it? 
                            Is it trying to <strong>inform you or sell you something</strong>?
                            Rate each 1-5 (1=bad, 5=great). Good sources average 4+.
                        </div>

                        <details>
                            <summary>Click to see how to cite sources</summary>
                            <div>
                                <strong>MLA Format Examples:</strong>
                                <ul>
                                    <li>
                                        <strong>Article:</strong><br>
                                        Smith, Jane. "Nuclear Safety After Fukushima." <em>Energy Policy</em>, vol. 45, 2022, pp. 12-28.
                                    </li>
                                    <li>
                                        <strong>Website:</strong><br>
                                        Nuclear Regulatory Commission. "Operating Nuclear Power Reactors." <em>NRC.gov</em>, 15 Jan. 2024, www.nrc.gov/reactors/operating.html.
                                    </li>
                                    <li>
                                        <strong>Database:</strong><br>
                                        Doe, John. "Climate and Nuclear Power." <em>Gale Opposing Viewpoints</em>, 2023. Accessed 1 Feb. 2024.
                                    </li>
                                </ul>
                                <strong style="margin-top: 1rem; display: block;">Chicago Format Examples:</strong>
                                <ul>
                                    <li>
                                        <strong>Article:</strong><br>
                                        Smith, Jane. "Nuclear Safety After Fukushima." <em>Energy Policy</em> 45 (2022): 12-28.
                                    </li>
                                    <li>
                                        <strong>Website:</strong><br>
                                        Nuclear Regulatory Commission. "Operating Nuclear Power Reactors." NRC.gov. January 15, 2024. https://www.nrc.gov/reactors/operating.html.
                                    </li>
                                </ul>
                            </div>
                        </details>

                        <div class="info-box info-box-green" style="margin-top: 1.5rem;">
                            <strong>ðŸ’¡ How to Use Your Sources:</strong><br><br>
                            
                            <strong>PARAPHRASE (your own words) - use most of the time:</strong><br>
                            âŒ BAD: "Nuclear power is safe" [no citation]<br>
                            âœ… GOOD: "According to the NRC, nuclear plants have strong safety records compared to other energy sources (Smith, 2024)."<br><br>
                            
                            <strong>QUOTE DIRECTLY (exact words) - use sparingly:</strong><br>
                            âŒ BAD: She said nuclear is safe and we should use it.<br>
                            âœ… GOOD: The EPA director stated that nuclear plants are "among the safest energy sources per unit of electricity" (Jones, 2023).<br><br>
                            
                            <strong>Both need citations!</strong> Quote when the exact language is powerful or when you need precision.
                        </div>

                        <h3 class="text-purple mb-3 mt-3" style="font-size: 1.3rem; font-weight: 700;">Evidence FOR Your Position</h3>
                        ${this.state.evidence.map((item, index) => {
                            const citationType = item.citationType || 'mla';
                            return `
                            <div class="card card-purple">
                                <div class="card-header">
                                    <span class="card-title">
                                        EVIDENCE ${index + 1}
                                        ${item.isExample ? `
                                            <span class="example-badge">
                                                âš ï¸ EXAMPLE
                                                <button class="btn-delete-example" data-action="delete-example-evidence" data-index="${index}">
                                                    ${icons.X} Delete
                                                </button>
                                            </span>
                                        ` : ''}
                                    </span>
                                    <select data-bind="evidence.${index}.citationType" style="font-size: 0.9rem; padding: 0.5rem;" aria-label="Citation format for evidence ${index + 1}">
                                        <option value="mla" ${citationType === 'mla' ? 'selected' : ''}>MLA Format</option>
                                        <option value="chicago" ${citationType === 'chicago' ? 'selected' : ''}>Chicago Format</option>
                                    </select>
                                    ${!item.isExample ? `
                                        <button class="btn-delete" data-action="delete-evidence" data-index="${index}" aria-label="Delete evidence ${index + 1}">
                                            ${icons.Trash2} Delete
                                        </button>
                                    ` : ''}
                                </div>
                                
                                <label class="inline" for="evidence-${index}-claim">What Does This Source Say?</label>
                                <input 
                                    id="evidence-${index}-claim"
                                    type="text" 
                                    value="${this.escapeHtml(item.claim || '')}" 
                                    placeholder="The fact, stat, or quote you're using"
                                    data-bind="evidence.${index}.claim"
                                />
                                
                                <label class="inline" for="evidence-${index}-source" style="margin-top: 1rem;">Where's It From?</label>
                                <input 
                                    id="evidence-${index}-source"
                                    type="text" 
                                    value="${this.escapeHtml(item.source || '')}" 
                                    placeholder="Source name and author"
                                    data-bind="evidence.${index}.source"
                                />
                                
                                <label class="inline" for="evidence-${index}-citation" style="margin-top: 1rem;">Full Citation</label>
                                <input 
                                    id="evidence-${index}-citation"
                                    type="text" 
                                    value="${this.escapeHtml(item.citation || '')}" 
                                    placeholder="Complete citation (see examples above)"
                                    data-bind="evidence.${index}.citation"
                                />
                                
                                <label class="inline" style="margin-top: 1.5rem;">How Good Is This Source? (Rate 1-5 for each)</label>
                                <div class="craap-grid">
                                    <div class="craap-item">
                                        <label class="inline" for="evidence-${index}-currency">Recent?</label>
                                        <input 
                                            id="evidence-${index}-currency"
                                            type="number" 
                                            min="1" 
                                            max="5" 
                                            value="${item.currency || ''}"
                                            data-bind="evidence.${index}.currency" 
                                            placeholder="1-5"
                                            aria-label="Currency rating for evidence ${index + 1}"
                                        />
                                    </div>
                                    <div class="craap-item">
                                        <label class="inline" for="evidence-${index}-relevance">Relevant?</label>
                                        <input 
                                            id="evidence-${index}-relevance"
                                            type="number" 
                                            min="1" 
                                            max="5" 
                                            value="${item.relevance || ''}"
                                            data-bind="evidence.${index}.relevance" 
                                            placeholder="1-5"
                                            aria-label="Relevance rating for evidence ${index + 1}"
                                        />
                                    </div>
                                    <div class="craap-item">
                                        <label class="inline" for="evidence-${index}-authority">Expert?</label>
                                        <input 
                                            id="evidence-${index}-authority"
                                            type="number" 
                                            min="1" 
                                            max="5" 
                                            value="${item.authority || ''}"
                                            data-bind="evidence.${index}.authority" 
                                            placeholder="1-5"
                                            aria-label="Authority rating for evidence ${index + 1}"
                                        />
                                    </div>
                                    <div class="craap-item">
                                        <label class="inline" for="evidence-${index}-accuracy">Accurate?</label>
                                        <input 
                                            id="evidence-${index}-accuracy"
                                            type="number" 
                                            min="1" 
                                            max="5" 
                                            value="${item.accuracy || ''}"
                                            data-bind="evidence.${index}.accuracy" 
                                            placeholder="1-5"
                                            aria-label="Accuracy rating for evidence ${index + 1}"
                                        />
                                    </div>
                                    <div class="craap-item">
                                        <label class="inline" for="evidence-${index}-purpose">Trustworthy?</label>
                                        <input 
                                            id="evidence-${index}-purpose"
                                            type="number" 
                                            min="1" 
                                            max="5" 
                                            value="${item.purpose || ''}"
                                            data-bind="evidence.${index}.purpose" 
                                            placeholder="1-5"
                                            aria-label="Purpose rating for evidence ${index + 1}"
                                        />
                                    </div>
                                </div>
                                
                                <label class="inline" for="evidence-${index}-reliability" style="margin-top: 1rem;">Why Trust This Source?</label>
                                <textarea 
                                    id="evidence-${index}-reliability"
                                    placeholder="Who wrote it? What makes them credible? Any bias to watch for?"
                                    data-bind="evidence.${index}.reliability"
                                >${this.escapeHtml(item.reliability || '')}</textarea>
                            </div>
                        `}).join('')}
                        <button class="btn-add" data-action="add-evidence" aria-label="Add new evidence">
                            ${icons.Plus} Add Evidence
                        </button>

                        <h3 class="text-red mb-3 mt-4" style="font-size: 1.3rem; font-weight: 700;">Evidence AGAINST Your Position (Be Ready!)</h3>
                        <p class="text-gray-light mb-2" style="font-style: italic;">
                            <strong>ðŸ’¡ Why track evidence against you?</strong> This isn't about finding reasons your side is wrong. 
                            It's about PREPARING so you're not surprised during the debate. Knowing their best evidence makes YOUR response stronger. 
                            Great debaters anticipate challenges!
                        </p>
                        ${this.state.evidenceAgainst.map((item, index) => `
                            <div class="card card-red">
                                <div class="card-header">
                                    <span class="card-title">THEIR EVIDENCE ${index + 1}</span>
                                    <button class="btn-delete" data-action="delete-evidence-against" data-index="${index}" aria-label="Delete evidence against ${index + 1}">
                                        ${icons.Trash2} Delete
                                    </button>
                                </div>
                                
                                <label class="inline" for="evidence-against-${index}-claim">What Will They Say?</label>
                                <input 
                                    id="evidence-against-${index}-claim"
                                    type="text" 
                                    value="${this.escapeHtml(item.claim || '')}" 
                                    placeholder="The fact/stat that hurts your case"
                                    data-bind="evidenceAgainst.${index}.claim"
                                />
                                
                                <label class="inline" for="evidence-against-${index}-source" style="margin-top: 1rem;">Where's It From?</label>
                                <input 
                                    id="evidence-against-${index}-source"
                                    type="text" 
                                    value="${this.escapeHtml(item.source || '')}" 
                                    placeholder="Their source"
                                    data-bind="evidenceAgainst.${index}.source"
                                />
                                
                                <label class="inline" for="evidence-against-${index}-response" style="margin-top: 1rem;">Your Response</label>
                                <textarea 
                                    id="evidence-against-${index}-response"
                                    placeholder="How will you counter this? What context are they missing?"
                                    data-bind="evidenceAgainst.${index}.response"
                                >${this.escapeHtml(item.response || '')}</textarea>
                            </div>
                        `).join('')}
                        <button class="btn-add" data-action="add-evidence-against" aria-label="Add evidence against your position">
                            ${icons.Plus} Add Evidence They'll Use
                        </button>
                    </div>
                `;
            }

            renderRubric() {
                if (!this.state.expandedSections.rubric) return '';
                
                const criteria = [
                    { 
                        title: 'Opening Statement (3 pts)', 
                        desc: 'Clear position, good hook to grab attention, preview of your main arguments' 
                    },
                    { 
                        title: 'Evidence (4 pts)', 
                        desc: 'Good variety of credible sources, accurate facts and numbers, proper citations' 
                    },
                    { 
                        title: 'Logic (4 pts)', 
                        desc: 'Arguments make sense and connect to your point, no logical fallacies' 
                    },
                    {
                        title: 'Fair Thinking (4 pts)',
                        desc: 'Shows you get it\'s complicated, doesn\'t exaggerate claims, explains the other side fairly, shows deep thinking'
                    },
                    { 
                        title: 'Cross-Examination (3 pts)', 
                        desc: 'Smart questions that challenge the other team, good answers to their questions, stays calm' 
                    },
                    { 
                        title: 'Speaking Skills (4 pts)', 
                        desc: 'Eye contact, clear voice, good pacing, persuasive, not just reading' 
                    },
                    { 
                        title: 'Teamwork (4 pts)', 
                        desc: 'Smooth handoffs between speakers, everyone participates, well organized' 
                    },
                    { 
                        title: 'Closing Statement (4 pts)', 
                        desc: 'Strong summary of your points, addresses their best arguments, memorable ending' 
                    }
                ];

                return `
                    <div class="section-content">
                        <div class="info-box info-box-yellow">
                            <strong>How You'll Be Graded:</strong> Total of 30 points. 
                            Notice "Fair Thinking" is worth 4 pointsâ€”being able to see complexity and understand 
                            the other side is a big deal, not just "winning."
                        </div>

                        <div class="grid-2">
                            ${criteria.map(item => `
                                <div class="card card-green">
                                    <h4 class="card-title">${item.title}</h4>
                                    <p class="text-white">${item.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderFactCheck() {
                if (!this.state.expandedSections.factCheck) return '';
                
                const factCheckScenarios = [
                    {
                        claim: '"Nuclear power has zero emissions"',
                        reality: 'Not quite. Nuclear plants don\'t produce emissions while running, BUT uranium mining and plant construction do create some COâ‚‚. The full lifecycle is about 12g COâ‚‚ per kWhâ€”way better than coal (820g) or gas (490g), but not literally zero.',
                        questions: [
                            'Are they talking about running the plant, or the whole lifecycle?',
                            'How does it compare to solar (40g), wind (11g), and coal (820g)?',
                            'Source note: These numbers are from <a href="https://www.ipcc.ch/report/ar6/wg3/" target="_blank" rel="noopener noreferrer" class="source-link">IPCC lifecycle assessments</a> and may vary slightly by study.'
                        ]
                    },
                    {
                        claim: '"Nuclear waste is dangerous for thousands of years"',
                        reality: 'True, but needs context. High-level waste stays radioactive for about 10,000 years. HOWEVER, the amount is super smallâ€”a lifetime of electricity for one person = waste the size of a soda can. And dry cask storage has worked safely for decades.',
                        questions: [
                            'How much waste does this plant actually produce per year?',
                            'How does it compare to coal ash or old solar panels?',
                            'What are the actual risks of current storage? (See <a href="https://www.nrc.gov/waste/spent-fuel-storage.html" target="_blank" rel="noopener noreferrer" class="source-link">NRC on dry cask storage</a>)'
                        ]
                    },
                    {
                        claim: '"Accidents like Chernobyl prove nuclear is unsafe"',
                        reality: 'This needs major context. Chernobyl used a bad Soviet design that doesn\'t exist in the US. Fukushima was hit by a massive tsunami, not a normal problem. US plants have way better safety systems. Deaths from Chernobyl: WHO/UN estimate ~4,000 over time (though other estimates range higherâ€”this is scientifically debated). Deaths from fossil fuel air pollution: 8 million PER YEAR (WHO estimate). Nuclear has 0.07 deaths per TWh vs coal\'s 25 deaths per TWh.',
                        questions: [
                            'What kind of reactor was it? (Very different designs)',
                            'What actually caused the accident?',
                            'How many people really died? (Compare to <a href="https://ourworldindata.org/safest-sources-of-energy" target="_blank" rel="noopener noreferrer" class="source-link">deaths per TWh for all energy sources</a>)',
                            'What safety improvements happened after?'
                        ]
                    },
                    {
                        claim: '"Nuclear is too expensive" OR "Nuclear is the cheapest"',
                        reality: 'BOTH can be true! It depends what you\'re measuring. Running an EXISTING nuclear plant is cheap (~$30/MWh operating costs). Building a BRAND NEW plant from scratch is extremely expensive ($15-30+ billion upfrontâ€”Vogtle Units 3&4 in Georgia cost over $35 billionâ€”and takes 10-15+ years). This is why people argue past each other on cost.',
                        questions: [
                            'Are they talking about an existing plant or building a new one?',
                            'What costs are included? (Just fuel? Or construction, decommissioning, waste storage?)',
                            'How does it compare to building new solar/wind farms PLUS battery storage?',
                            'Over what time period? (Nuclear plants run 60-80 years)',
                            'Vogtle reality: The recent Vogtle 3&4 project in Georgia took over a decade and cost $35+ billion (way over budget). <a href="https://www.eia.gov/todayinenergy/detail.php?id=52018" target="_blank" rel="noopener noreferrer" class="source-link">Source: EIA</a>'
                        ]
                    }
                ];
                
                return `
                    <div class="section-content">
                        <div class="info-box info-box-yellow">
                            <strong>Don't Get Fooled:</strong> A lot of nuclear claims are technically true but missing important context. 
                            Always ask: "Compared to what? What's the full story?"
                        </div>

                        <h3 class="text-yellow mb-3" style="font-size: 1.3rem; font-weight: 700;">Claims That Need Context</h3>
                        ${factCheckScenarios.map((scenario, idx) => `
                            <div class="card card-orange" style="margin-bottom: 1.5rem;">
                                <h4 class="card-title">Claim: ${scenario.claim}</h4>
                                <p class="text-white mb-2"><strong>The Real Story:</strong> ${scenario.reality}</p>
                                <p class="text-white"><strong>Questions to Ask:</strong></p>
                                <ul class="text-white" style="list-style: none; padding-left: 1rem;">
                                    ${scenario.questions.map(q => `<li style="margin-bottom: 0.5rem;">â€¢ ${q}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}

                        <h3 class="text-yellow mb-3 mt-4" style="font-size: 1.3rem; font-weight: 700;">How to Check Sources</h3>
                        <div class="grid-2">
                            <div class="card card-orange">
                                <h4 class="card-title">Check for Bias</h4>
                                <ul class="text-white" style="list-style: none;">
                                    <li class="mb-2">âœ“ Is this recent info?</li>
                                    <li class="mb-2">âœ“ Who paid for this research?</li>
                                    <li class="mb-2">âœ“ Do they show both sides or just one?</li>
                                    <li class="mb-2">âœ“ Do they admit when they're not sure?</li>
                                </ul>
                            </div>

                            <div class="card card-orange">
                                <h4 class="card-title">Check the Numbers</h4>
                                <ul class="text-white" style="list-style: none;">
                                    <li class="mb-2">âœ“ What's missing from this stat?</li>
                                    <li class="mb-2">âœ“ What are they comparing it to?</li>
                                    <li class="mb-2">âœ“ Could this number be misleading?</li>
                                </ul>
                            </div>

                            <div class="card card-orange" style="grid-column: span 2;">
                                <h4 class="card-title">Don't Just Read Itâ€”Google It!</h4>
                                <ul class="text-white" style="list-style: none;">
                                    <li class="mb-2">âœ“ Don't just read the articleâ€”search FOR the organization</li>
                                    <li class="mb-2">âœ“ Open Wikipedia and look them up</li>
                                    <li class="mb-2">âœ“ What do OTHER sources say ABOUT this source?</li>
                                    <li class="mb-2">âœ“ Example: Google "Nuclear Energy Institute" â†’ Wikipedia shows it's an industry group (they promote nuclear)</li>
                                    <li class="mb-2">âœ“ Example: Google "Union of Concerned Scientists" â†’ It's an environmental group (they critique nuclear)</li>
                                    <li class="mb-2">âœ“ Neither is bad! Just know where they're coming from.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderFallacies() {
                if (!this.state.expandedSections.fallacies) return '';
                
                const fallacies = [
                    { 
                        name: 'Ad Hominem', 
                        desc: 'Attacking the person instead of their argument',
                        example: '"You can\'t trust that studyâ€”the author works for a nuclear company!"'
                    },
                    { 
                        name: 'Straw Man', 
                        desc: 'Twisting what they said to make it easier to argue against',
                        example: '"You support nuclear, so you don\'t care about the environment at all!"'
                    },
                    { 
                        name: 'False Choice', 
                        desc: 'Acting like there are only two options when there are more',
                        example: '"It\'s either nuclear or we burn coal forever!"'
                    },
                    { 
                        name: 'Cherry-Picking', 
                        desc: 'Only showing evidence that helps you, hiding the rest',
                        example: 'Only talking about Chernobyl, ignoring decades of safe operation elsewhere'
                    },
                    { 
                        name: 'Appeal to Emotion', 
                        desc: 'Using feelings instead of facts',
                        example: '"Think of the children exposed to radiation!" (without showing actual risk data)'
                    },
                    { 
                        name: 'Hasty Generalization', 
                        desc: 'Making a big claim from limited evidence',
                        example: '"One study found cancer near a plant, so all nuclear plants cause cancer!"'
                    }
                ];

                return `
                    <div class="section-content">
                        <div class="info-box info-box-yellow">
                            <strong>Bad Logic to Avoid:</strong> Don't use these tricks in your arguments, 
                            and call them out (nicely!) when the other team does.
                        </div>

                        <div class="grid-2">
                            ${fallacies.map(fallacy => `
                                <div class="card card-red">
                                    <h4 class="card-title">${fallacy.name}</h4>
                                    <p class="text-white mb-2"><strong>What it is:</strong> ${fallacy.desc}</p>
                                    <p class="text-white"><strong>Example:</strong> ${fallacy.example}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderDebateFlow() {
                if (!this.state.expandedSections.debateFlow) return '';
                
                while (this.state.flow.length < this.state.arguments.length) {
                    this.state.flow.push({ opening: '', opponentRebuttal: '', extension: '', closing: '' });
                }
                
                return `
                    <div class="section-content">
                        <div class="info-box info-box-blue">
                            <strong>Track Your Arguments:</strong> Plan how each argument moves through the whole debate. 
                            This helps you stay consistent and remember what to emphasize at the end.
                        </div>

                        <div class="flow-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="color: #e8a838;">Arg #</th>
                                        <th style="color: #86efac;">Your Opening</th>
                                        <th style="color: #f87171;">They Say</th>
                                        <th style="color: #86efac;">You Rebuild</th>
                                        <th style="color: #93c5fd;">Closing</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${this.state.arguments.map((arg, idx) => {
                                        const flow = this.state.flow[idx] || { opening: '', opponentRebuttal: '', extension: '', closing: '' };
                                        return `
                                        <tr>
                                            <td style="font-weight: 700;">#${idx + 1}</td>
                                            <td>
                                                <textarea 
                                                    data-bind="flow.${idx}.opening" 
                                                    placeholder="How will you say this first?"
                                                    aria-label="Opening for argument ${idx + 1}"
                                                >${this.escapeHtml(flow.opening || '')}</textarea>
                                            </td>
                                            <td>
                                                <textarea 
                                                    data-bind="flow.${idx}.opponentRebuttal" 
                                                    placeholder="What might they say back?"
                                                    aria-label="Opponent rebuttal for argument ${idx + 1}"
                                                >${this.escapeHtml(flow.opponentRebuttal || '')}</textarea>
                                            </td>
                                            <td>
                                                <textarea 
                                                    data-bind="flow.${idx}.extension" 
                                                    placeholder="How will you respond?"
                                                    aria-label="Extension for argument ${idx + 1}"
                                                >${this.escapeHtml(flow.extension || '')}</textarea>
                                            </td>
                                            <td>
                                                <textarea 
                                                    data-bind="flow.${idx}.closing" 
                                                    placeholder="Why does this matter?"
                                                    aria-label="Closing impact for argument ${idx + 1}"
                                                >${this.escapeHtml(flow.closing || '')}</textarea>
                                            </td>
                                        </tr>
                                    `}).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        ${this.state.arguments.length === 0 ? `
                            <p class="text-gray-light mt-3" style="text-align: center; font-style: italic;">
                                Add arguments above to use this tracker
                            </p>
                        ` : ''}
                    </div>
                `;
            }

            renderPrep() {
                if (!this.state.expandedSections.prep) return '';
                
                const timerModes = [
                    { mode: 'opening', label: 'Opening', seconds: 120 },
                    { mode: 'arguments', label: 'Arguments', seconds: 240 },
                    { mode: 'rebuttal', label: 'Rebuttal', seconds: 120 },
                    { mode: 'crossExam', label: 'Cross-Exam', seconds: 180 },
                    { mode: 'closing', label: 'Closing', seconds: 120 }
                ];

                return `
                    <div class="section-content">
                        <div class="team-roles">
                            <h4>ðŸ¤ TEAM ROLES (Who's doing what?)</h4>
                            <div class="role-item">
                                <span class="role-label">Opening Speaker:</span>
                                <input type="text" data-bind="teamRoles.opening" value="${this.escapeHtml(this.state.teamRoles.opening)}" placeholder="Name" />
                            </div>
                            <div class="role-item">
                                <span class="role-label">Main Arguments Speaker:</span>
                                <input type="text" data-bind="teamRoles.mainArgs" value="${this.escapeHtml(this.state.teamRoles.mainArgs)}" placeholder="Name" />
                            </div>
                            <div class="role-item">
                                <span class="role-label">Cross-Examination Lead:</span>
                                <input type="text" data-bind="teamRoles.crossEx" value="${this.escapeHtml(this.state.teamRoles.crossEx)}" placeholder="Name" />
                            </div>
                            <div class="role-item">
                                <span class="role-label">Closing Speaker:</span>
                                <input type="text" data-bind="teamRoles.closing" value="${this.escapeHtml(this.state.teamRoles.closing)}" placeholder="Name" />
                            </div>
                            <div class="role-item">
                                <span class="role-label">Researcher/Fact-Checker:</span>
                                <input type="text" data-bind="teamRoles.researcher" value="${this.escapeHtml(this.state.teamRoles.researcher)}" placeholder="Name" />
                            </div>
                            <label class="inline" style="margin-top: 1rem;">Team Strategy Notes</label>
                            <textarea data-bind="teamRoles.strategy" placeholder="How will you coordinate? What's your backup plan if something goes wrong?">${this.escapeHtml(this.state.teamRoles.strategy)}</textarea>
                        </div>

                        <div class="timer-container">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                ${icons.Clock}
                                <h3 class="text-green" style="font-size: 1.5rem; font-weight: 700; margin: 0;">Practice Timer</h3>
                            </div>

                            <div class="timer-buttons">
                                ${timerModes.map(tm => `
                                    <button 
                                        class="timer-btn" 
                                        data-timer="${tm.mode}" 
                                        data-seconds="${tm.seconds}"
                                        aria-label="Set timer to ${tm.label} - ${Math.floor(tm.seconds/60)} minutes ${tm.seconds%60} seconds"
                                    >
                                        ${tm.label}<br>${Math.floor(tm.seconds/60)}:${(tm.seconds%60).toString().padStart(2,'0')}
                                    </button>
                                `).join('')}
                            </div>

                            <div class="timer-display" role="timer" aria-live="polite" aria-atomic="true">
                                <div class="timer-value" aria-label="Time remaining">
                                    ${Math.floor(this.state.timerSeconds/60)}:${(this.state.timerSeconds%60).toString().padStart(2,'0')}
                                </div>
                                <div class="timer-label">${this.state.timerMode.replace(/([A-Z])/g, ' $1').toUpperCase()}</div>
                            </div>

                            <div class="timer-controls">
                                ${this.state.timerActive ? 
                                    `<button class="timer-control-btn btn-pause" data-action="pause" aria-label="Pause timer">Pause</button>` :
                                    `<button class="timer-control-btn btn-start" data-action="start" aria-label="Start timer">Start</button>`
                                }
                                <button class="timer-control-btn btn-reset" data-action="reset" aria-label="Reset timer">Reset</button>
                            </div>
                        </div>

                        <div class="mt-4">
                            <label for="opening-statement">Opening Statement (2 Minutes)</label>
                            <p class="text-gray-light mb-2" style="font-style: italic;">
                                Start strong! Pick ONE opening hook, then state your position clearly.
                            </p>
                            <div class="info-box info-box-green" style="margin-bottom: 1rem;">
                                <strong>Opening Hook Ideas:</strong>
                                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                    <li><strong>Shocking Stat:</strong> "Every hour, Salem and Hope Creek prevent 1,140 tons of COâ‚‚..."</li>
                                    <li><strong>Question:</strong> "What if there's an energy source safer than solar AND wind?"</li>
                                    <li><strong>Bold Claim:</strong> "Nuclear power is our only realistic path to zero emissions by 2050."</li>
                                </ul>
                            </div>
                            <textarea 
                                id="opening-statement"
                                data-bind="openingStatement" 
                                placeholder="Write your opening here..."
                                aria-label="Opening statement draft"
                            >${this.escapeHtml(this.state.openingStatement)}</textarea>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-yellow mb-3" style="font-size: 1.3rem; font-weight: 700;">Cross-Examination Questions (3 Minutes)</h3>
                            <p class="text-gray-light mb-3" style="font-style: italic;">
                                Plan smart questions that expose holes in their arguments or force them to admit stuff.
                            </p>
                            ${this.state.questions.map((q, index) => `
                                <div class="card card-teal">
                                    <div class="card-header">
                                        <span class="card-title">QUESTION ${index + 1}</span>
                                        <button class="btn-delete" data-action="delete-question" data-index="${index}" aria-label="Delete question ${index + 1}">
                                            ${icons.Trash2} Delete
                                        </button>
                                    </div>
                                    <label class="inline" for="question-${index}-question">Question</label>
                                    <input 
                                        id="question-${index}-question"
                                        type="text" 
                                        value="${this.escapeHtml(q.question || '')}" 
                                        placeholder="What will you ask?"
                                        data-bind="questions.${index}.question"
                                    />
                                    <label class="inline" for="question-${index}-purpose" style="margin-top: 1rem;">Why are you asking this?</label>
                                    <input 
                                        id="question-${index}-purpose"
                                        type="text" 
                                        value="${this.escapeHtml(q.purpose || '')}" 
                                        placeholder="What are you trying to get them to admit or mess up?"
                                        data-bind="questions.${index}.purpose"
                                    />
                                </div>
                            `).join('')}
                            <button class="btn-add" data-action="add-question" aria-label="Add cross-examination question">
                                ${icons.Plus} Add Question
                            </button>
                        </div>

                        <div class="mt-4">
                            <label for="closing-statement">Closing Statement (2 Minutes)</label>
                            <p class="text-gray-light mb-2" style="font-style: italic;">
                                Wrap it up strong. Remind them why you won, address their best point, memorable ending.
                            </p>
                            <textarea 
                                id="closing-statement"
                                data-bind="closingStatement" 
                                placeholder="Write your closing here..."
                                aria-label="Closing statement draft"
                            >${this.escapeHtml(this.state.closingStatement)}</textarea>
                        </div>

                        <div class="mt-4" style="background: linear-gradient(to right, #1e3a8a, #1e40af); border: 3px solid #3b82f6; border-radius: 0.75rem; padding: 2rem;">
                            <h3 class="text-yellow mb-3" style="font-size: 1.3rem; font-weight: 700;">Before Debate Day</h3>
                            <ul class="text-white" style="list-style: none; font-size: 1.05rem; line-height: 1.8;">
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Check all your sources are good (most should rate 4+ on your checklist)</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Practice out loud with your teamâ€”seriously, say it out loud!</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Make sure you understand the other side's arguments (not just yours)</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Time yourselvesâ€”2 minutes goes faster than you think!</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Split up who says whatâ€”everyone should participate</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Bring note cards with your sources (you can reference them!)</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>Print your cheat sheet for quick reference</span>
                                </li>
                                <li style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                    <span class="text-green" style="font-weight: 700;">âœ“</span>
                                    <span>If you don't know an answer in cross-ex, it's OK to say "I'd need to check my notes on that"</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            render() {
                const sections = [
                    { key: 'research', icon: icons.BookOpen, title: 'Research Your Topic', renderer: () => this.renderResearchSection() },
                    { key: 'searchStrategy', icon: icons.BookOpen, title: 'Search Tips', renderer: () => this.renderSearchStrategy() },
                    { key: 'arguments', icon: icons.Lightbulb, title: 'Build Your Arguments', renderer: () => this.renderArguments() },
                    { key: 'evidence', icon: icons.FileText, title: 'Track Your Evidence', renderer: () => this.renderEvidence() },
                    { key: 'rubric', icon: icons.Award, title: 'How You\'ll Be Graded', renderer: () => this.renderRubric() },
                    { key: 'factCheck', icon: icons.AlertTriangle, title: 'Fact-Check Everything', renderer: () => this.renderFactCheck() },
                    { key: 'fallacies', icon: icons.AlertTriangle, title: 'Avoid Bad Logic', renderer: () => this.renderFallacies() },
                    { key: 'debateFlow', icon: icons.Award, title: 'Track Arguments Through Debate', renderer: () => this.renderDebateFlow() },
                    { key: 'prep', icon: icons.Clock, title: 'Debate Day Prep', renderer: () => this.renderPrep() }
                ];

                this.shadowRoot.innerHTML = `
                    <style>${css}</style>
                    <a href="#main-content" class="skip-link">Skip to main content</a>
                    <div class="save-indicator" role="status" aria-live="polite">Auto-saved</div>
                    <div class="container">
                        <div class="max-w-6xl">
                            ${this.renderHeader()}
                            <div id="main-content" tabindex="-1">
                                ${this.renderGettingStarted()}
                                ${this.renderProgress()}
                                ${this.renderControls()}
                                
                                ${sections.map(section => `
                                    <div class="section-panel">
                                        <button 
                                            class="section-header" 
                                            data-toggle="${section.key}"
                                            aria-expanded="${this.state.expandedSections[section.key]}"
                                            aria-controls="section-${section.key}"
                                        >
                                            <div class="section-title">
                                                <span class="text-yellow" aria-hidden="true">${section.icon}</span>
                                                <h2>${section.title}</h2>
                                            </div>
                                            <span class="text-green" aria-hidden="true">
                                                ${this.state.expandedSections[section.key] ? icons.ChevronUp : icons.ChevronDown}
                                            </span>
                                        </button>
                                        <div id="section-${section.key}" ${this.state.expandedSections[section.key] ? '' : 'hidden'}>
                                            ${section.renderer()}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                this.attachEventListeners();
            }

            attachEventListeners() {
                const root = this.shadowRoot;

                root.querySelectorAll('[data-toggle]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.toggleSection(btn.dataset.toggle);
                    });
                });

                root.querySelectorAll('[data-bind]').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const path = e.target.dataset.bind.split('.');
                        const value = e.target.type === 'number' ? parseInt(e.target.value) || '' : e.target.value;
                        
                        if (path.length === 1) {
                            this.state[path[0]] = value;
                        } else if (path.length === 2) {
                            this.state[path[0]][path[1]] = value;
                        } else if (path.length === 3) {
                            const [obj, index, key] = path;
                            const idx = parseInt(index);
                            if (this.state[obj][idx]) {
                                this.state[obj][idx][key] = value;
                            }
                        }
                        
                        this.debouncedSave();
                    });

                    if (input.dataset.bind === 'position' || input.dataset.bind === 'selectedPlant') {
                        input.addEventListener('change', () => {
                            this.saveState();
                            this.render();
                        });
                    }
                });

                root.addEventListener('click', (e) => {
                    const btn = e.target.closest('button[data-action]');
                    if (!btn) return;

                    const action = btn.dataset.action;
                    const index = parseInt(btn.dataset.index);

                    switch(action) {
                        case 'print':
                            window.print();
                            break;
                        case 'print-cheat':
                            this.printCheatSheet();
                            break;
                        case 'dismiss-guide':
                            this.dismissGettingStarted();
                            break;
                        case 'add-arg':
                            this.state.arguments.push({ 
                                claim: '', 
                                data: '', 
                                warrant: '', 
                                qualifier: '', 
                                rebuttal: '', 
                                source: '' 
                            });
                            this.saveState();
                            this.render();
                            break;
                        case 'delete-arg':
                        case 'delete-example-arg':
                            this.state.arguments.splice(index, 1);
                            this.state.flow.splice(index, 1);
                            this.saveState();
                            this.render();
                            break;
                        case 'add-counter':
                            this.state.counterArgs.push({ 
                                opposing: '', 
                                understanding: '',
                                rebuttal: '' 
                            });
                            this.saveState();
                            this.render();
                            break;
                        case 'delete-counter':
                        case 'delete-example-counter':
                            this.state.counterArgs.splice(index, 1);
                            this.saveState();
                            this.render();
                            break;
                        case 'add-evidence':
                            this.state.evidence.push({ 
                                claim: '', 
                                source: '', 
                                citation: '', 
                                citationType: 'mla',
                                currency: '', 
                                relevance: '', 
                                authority: '', 
                                accuracy: '', 
                                purpose: '', 
                                reliability: '' 
                            });
                            this.saveState();
                            this.render();
                            break;
                        case 'delete-evidence':
                        case 'delete-example-evidence':
                            this.state.evidence.splice(index, 1);
                            this.saveState();
                            this.render();
                            break;
                        case 'add-evidence-against':
                            this.state.evidenceAgainst.push({
                                claim: '',
                                source: '',
                                response: ''
                            });
                            this.saveState();
                            this.render();
                            break;
                        case 'delete-evidence-against':
                            this.state.evidenceAgainst.splice(index, 1);
                            this.saveState();
                            this.render();
                            break;
                        case 'add-question':
                            this.state.questions.push({ question: '', purpose: '' });
                            this.saveState();
                            this.render();
                            break;
                        case 'delete-question':
                            this.state.questions.splice(index, 1);
                            this.saveState();
                            this.render();
                            break;
                        case 'start':
                            this.state.timerActive = true;
                            this.updateControlButtons();
                            break;
                        case 'pause':
                            this.state.timerActive = false;
                            this.updateControlButtons();
                            break;
                        case 'reset':
                            this.state.timerActive = false;
                            const modes = {
                                opening: 120,
                                arguments: 240,
                                rebuttal: 120,
                                crossExam: 180,
                                closing: 120
                            };
                            this.state.timerSeconds = modes[this.state.timerMode] || 120;
                            this.updateTimerDisplay();
                            this.updateControlButtons();
                            break;
                    }
                });

                this.attachTimerControls();
            }

            attachTimerControls() {
                const root = this.shadowRoot;
                root.querySelectorAll('[data-timer]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.state.timerMode = btn.dataset.timer;
                        this.state.timerSeconds = parseInt(btn.dataset.seconds);
                        this.state.timerActive = false;
                        this.updateTimerDisplay();
                        this.updateControlButtons();
                    });
                });
            }
        }

        customElements.define('nuclear-debate-prep', NuclearDebatePrep);
    })();
    </script>
</body>
</html>
